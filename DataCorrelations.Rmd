---
title: "Correlations"
output: html_document
date: "2026-01-22"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#libraries
library(tidyverse)
library(corrplot)

```


```{r}
#merging genotypes and biomass based on their two shared columns "unique.ID" and "blocks"
Merged_GT_BMB <- left_join(Genotypes_2023_2024, Biomass_Blocks_Biomass_Blocks, by = c("unique.ID", "block"))

```

## Including Plots

```{r}
#filtering out data before boxplot
CMerged_GT_BMB <- Merged_GT_BMB %>% 
  filter(!is.na(total.biomass_g))
```


```{r}
#box plot for correlation between population and biomass
CMerged_GT_BMB %>% 
  ggplot(aes(x=pop.id, y=total.biomass_g)) +
  geom_boxplot(width = 0.7,position = position_dodge(0.75)) + 
  facet_wrap(~ `Plant Type`, scales = "free_x") +
  theme_bw() +
  labs(x="Population", y="Biomass", title="Population vs Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/Population vs Biomass.png", width = 20, height = 14, units = "in")

#column plot for population and average biomass
CMerged_GT_BMB %>% 
  group_by(pop.id) %>% 
  summarise(mean_biomass = mean(total.biomass_g, na.rm =TRUE)) %>% 
  ggplot(aes(x=pop.id, y=mean_biomass)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  theme_bw() +
  labs(x="Population", y="Average Biomass", title="Population vs Average Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/Population vs Average Biomass.png", width = 20, height = 8, units = "in")
```

```{r}
#mutate before left joining
class(CMerged_GT_BMB$unique.ID)
class(UCD_annual_census_20240718_corrected$unique.ID)

CMerged_GT_BMB <- CMerged_GT_BMB %>%
  mutate(unique.ID = as.character(unique.ID))

UCD_annual_census_20240718_corrected <- UCD_annual_census_20240718_corrected %>%
  mutate(unique.ID = as.character(unique.ID))

```


```{r}
#merging pop/biomass with annual census
Merged_PopBio_AnCen <- left_join(CMerged_GT_BMB, UCD_annual_census_20240718_corrected, by = c("unique.ID"))
```


```{r}
#plot for stem diameter vs biomass
Merged_PopBio_AnCen %>% 
  ggplot(aes(x=diam.mm, y=total.biomass_g)) +
  geom_point(width = 0.7,position = position_dodge(0.75)) + 
  facet_wrap(~ `Plant Type`, scales = "free_x") +
  theme_bw() +
  labs(x="Stem Diameter (mm)", y="Biomass", title="Population vs Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/StemDiametervsBiomass.png", width = 20, height = 8, units = "in")

#non facet plot
Merged_PopBio_AnCen %>% 
  ggplot(aes(x=diam.mm, y=total.biomass_g)) +
  geom_point(width = 0.7,position = position_dodge(0.75)) + 
  theme_bw() +
  labs(x="Stem Diameter (mm)", y="Biomass", title="Population vs Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/StemDiamvsBiomassNonFacet.png", width = 20, height = 14, units = "in")
```

```{r}
# calculating canopy area (ellipse area formula, /2 since they are diameters)
Merged_PopBio_AnCen$canopy_area <- pi * (Merged_PopBio_AnCen$overhd.diam/2) * (Merged_PopBio_AnCen$overhd.perp/2)

```

```{r}
# graph for canopy area vs biomass (faceted)
Merged_PopBio_AnCen %>% 
  ggplot(aes(x=canopy_area, y=total.biomass_g)) +
  geom_point(width = 0.3,position = position_dodge(0.75)) + 
  facet_wrap(~ `Plant Type`, scales = "free_x") +
  theme_bw() +
  labs(x="Canopy Area", y="Biomass", title="Canopy Area vs Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/CanopyAreavsBiomass.png", width = 20, height = 8, units = "in")

#non facet plot
Merged_PopBio_AnCen %>% 
  ggplot(aes(x=canopy_area, y=total.biomass_g)) +
  geom_point(width = 0.5,position = position_dodge(0.75)) + 
  theme_bw() +
  labs(x="Canopy Area", y="Biomass", title="Canopy Area vs Biomass") + 
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11), text=element_text(size=20))
ggsave("output/CanopyAreavsBiomassNonFacet.png", width = 20, height = 14, units = "in")
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
