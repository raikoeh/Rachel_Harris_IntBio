---
title: "Rachel_Harris_IntBio"
output: html_document
date: "2025-10-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries that I'll be using + initial setup
```{r}
library(tidyverse)
library(corrplot)

sem <- function(x, na.rm=FALSE) {           #for calculating standard error
  sd(x,na.rm=na.rm)/sqrt(length(na.omit(x)))
}
```

# Load TDR Data

```{r}
combined_tdr <- read_csv("../input/WL2_2024_TDR_Processed.csv") #produced in "TDR_Plots.R"
```

## All "over time" plots change date from character to actual dates
```{r}
#setting bed average
 bed_avg <- combined_tdr %>% 
  group_by(date, Bed) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE), .groups = "drop")

#Average TDR per Bed over Time Plot
 ggplot(bed_avg, aes(x = date, y = mean_TDR, color = Bed)) +
  geom_point(size = 3) +
  geom_line() +
  labs(title = "Average TDR per Bed over Time", y = "Avg TDR", x = "Date") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 11)) +
  scale_color_viridis_d(option = "viridis")
ggsave("../output/Bedovertime.png", width = 12, height = 8, units = "in")
 
#setting position average
 position_avg <- combined_tdr %>% 
  group_by(date, Position) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE), .groups = "drop")
 
#Average TDR per Position over Time Plot
 ggplot(position_avg, aes(x = date, y = mean_TDR, color = Position)) +
  geom_point(size = 3) +
  geom_line() +
  labs(title = "Average TDR per Position over Time", y = "Avg TDR", x = "Date") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11))
ggsave("../output/Positionovertime.png", width = 12, height = 8, units = "in")
```


```{r}
#Error bars
library(ggplot2)
library(dplyr)

#Mean TDR for Each Bed
bed_means <- combined_tdr %>% 
  group_by(Bed, Position) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE),
          sem_TDR=sem(TDR, na.rm=TRUE))
bed_means

#error bars are weird on this plot
bed_means %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=sem_TDR)) + 
  geom_col(width = 0.7,position = position_dodge(0.75)) +  
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR, ymax=mean_TDR+sem_TDR),  #there's three error bars per column - BQC, because bed_means has 3 rows for every bed (for the three positions per bed)
                width=.2, position = position_dodge(0.75)) + 
  theme_classic() + 
  labs(x="Bed", y="Mean TDR")

ggplot(bed_means, aes(x = Bed, y = mean_TDR)) +
  geom_col(fill = "steelblue") +
  labs(title = "Mean TDR per Bed", y = "Mean TDR", x = "Bed") +
  theme_minimal()
ggsave("../output/MeanTDRperBed.png", width = 12, height = 8, units = "in")


#Filtering plots for each bed position
bed_means %>% 
  filter(Position=="top") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at Top Position")
ggsave("../output/MeanTDRTopBeds.png", width = 12, height = 8, units = "in")

bed_means %>% 
  filter(Position=="middle") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at Middle Position")
ggsave("../output/MeanTDRMiddleBeds.png", width = 12, height = 8, units = "in")

bed_means %>% 
  filter(Position=="end") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at End Position")
ggsave("../output/MeanTDREndBeds.png", width = 12, height = 8, units = "in")
 
```
