---
title: "Rachel_Harris_IntBio"
output: html_document
date: "2025-10-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Libraries that I'll be using + initial setup
```{r}
library(tidyverse)
library(corrplot)

sem <- function(x, na.rm=FALSE) {           #for calculating standard error
  sd(x,na.rm=na.rm)/sqrt(length(na.omit(x)))
}
```

# Load TDR Data

```{r}
combined_tdr <- read_csv("../input/WL2_2024_TDR_Processed.csv") #produced in "TDR_Plots.R"
```

## All "over time" plots change date from character to actual dates
```{r}
#setting bed average
 bed_avg <- combined_tdr %>% 
  group_by(date, Bed) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE), .groups = "drop")

#Average TDR per Bed over Time Plot
 ggplot(bed_avg, aes(x = date, y = mean_TDR, color = Bed)) +
  geom_point(size = 3) +
  geom_line() +
  labs(title = "Average TDR per Bed over Time", y = "Avg TDR", x = "Date") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 11)) +
  scale_color_viridis_d(option = "viridis")
ggsave("../output/Bedovertime.png", width = 12, height = 8, units = "in")
 
#setting position average
 position_avg <- combined_tdr %>% 
  group_by(date, Position) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE), .groups = "drop")
 
#Average TDR per Position over Time Plot
 ggplot(position_avg, aes(x = date, y = mean_TDR, color = Position)) +
  geom_point(size = 3) +
  geom_line() +
  labs(title = "Average TDR per Position over Time", y = "Avg TDR", x = "Date") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11))
ggsave("../output/Positionovertime.png", width = 12, height = 8, units = "in")
```


```{r}
#Error bars
library(ggplot2)
library(dplyr)

#Mean TDR for Each Bed
bed_means <- combined_tdr %>% 
  group_by(Bed) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE),
          sem_TDR=sem(TDR, na.rm=TRUE))

bed_means



#should I keep this plot since the next plot is the Mean TDR per Bed?
bed_means %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=sem_TDR)) + 
  geom_col(width = 0.7,position = position_dodge(0.75)) +  
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR, ymax=mean_TDR+sem_TDR),
                width=.2, position = position_dodge(0.75)) + 
  theme_classic() + 
  labs(x="Bed", y="Mean TDR")

#Mean TDR per Bed
ggplot(bed_means, aes(x = Bed, y = mean_TDR)) +
  geom_col(fill = "steelblue") +
   geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  labs(title = "Mean TDR per Bed", y = "Mean TDR", x = "Bed") +
  theme_minimal()
ggsave("../output/MeanTDRperBed.png", width = 12, height = 8, units = "in")


#new df bed_pos_means
bed_pos_means <- combined_tdr %>% 
  group_by(Position, Bed) %>% 
  summarize(mean_TDR = mean(TDR, na.rm = TRUE),
          sem_TDR=sem(TDR, na.rm=TRUE))

bed_pos_means


#Filtering plots for each bed position
bed_pos_means %>% 
  filter(Position=="top") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at Top Position")
ggsave("../output/MeanTDRTopBeds.png", width = 12, height = 8, units = "in")

bed_pos_means %>% 
  filter(Position=="middle") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at Middle Position")
ggsave("../output/MeanTDRMiddleBeds.png", width = 12, height = 8, units = "in")

bed_pos_means %>% 
  filter(Position=="end") %>% 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="All Beds at End Position")
ggsave("../output/MeanTDREndBeds.png", width = 12, height = 8, units = "in")
 
```

```{r}
#Compare Bed and Position over time


#Example, A and B top
bed_pos_means %>% 
 filter(Bed %in% c("A", "B"), Position == "top") %>%  #only keep beds A and B, you could do position == "Top" for example 
  ggplot(aes(x=fct_reorder(Bed, mean_TDR), y=mean_TDR)) +
  geom_col(width = 0.7,position = position_dodge(0.75)) + 
  geom_errorbar(aes(ymin=mean_TDR-sem_TDR,ymax=mean_TDR+sem_TDR),width=.2, position = 
                  position_dodge(0.75)) + 
  theme_classic() +
  labs(x="Bed", y="Mean TDR", title="Beds A and B at Top Position")
ggsave("../output/MeanTDREndBeds.png", width = 12, height = 8, units = "in")

bed_tdr_avg <- combined_tdr %>% 
  group_by(Bed, date) %>% 
  summarise(
    mean_TDR=mean(TDR, na.rm=TRUE),
    sem_TDR=sem(TDR, na.rm=TRUE)/sqrt(n()), .groups = "drop")

bed_tdr_avg

#Average TDR of All Beds over Time
bed_tdr_avg %>%
  ggplot(aes(x =date, y =mean_TDR, color = Bed, group = Bed)) +
  geom_line(size = 1) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11)) +
  labs(x = "Date", y = "Average TDR", color = "Bed",
    title = "Average TDR for All Beds over Time") +
  scale_color_viridis_d(option = "viridis")
ggsave("../output/MeanTDREndBeds.png", width = 12, height = 8, units = "in")

#Average TDR of A, K, B, C over Time
bed_tdr_avg %>%
  filter(Bed %in% c("A", "B", "C", "K")) %>% 
  ggplot(aes(x =date, y =mean_TDR, color = Bed, group = Bed)) +
  geom_line(size = 1) +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust =1, size = 11)) +
  labs(x = "Date", y = "Average TDR", color = "Bed",
    title = "Average TDR for All Beds over Time") +
  scale_color_viridis_d(option = "viridis")
ggsave("../output/MeanTDREndBeds.png", width = 12, height = 8, units = "in")

```

```{r}
#fixing MetStationData1
MetStationData1$X.TIMESTAMP <- sub('^"', ' ', MetStationData1$X.TIMESTAMP) #took away " at the start of every timestamp
MetStationData1$X.TIMESTAMP <- as.POSIXct(MetStationData1$X.TIMESTAMP, format="%Y-%m-%d %H:%M:%S")

MetStationData1 <- MetStationData1 %>% slice(-c(1, 2)) #removed first two empty rows
```

